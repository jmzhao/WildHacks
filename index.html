<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Foundation | Welcome</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/vendor/modernizr.js"></script>
    <style>
		#map {
			width: 500px;
			height: 400px;
			margin:0 auto;
		}
	</style>
  </head>
  
  <body  onload="initialize()">

    <nav class="top-bar" data-topbar>
  <ul class="title-area">
    <li class="name">
       <h1><a href="/">Freemium</a></h1>
    </li>
  </ul>

  <section class="top-bar-section">
    <!-- Right Nav Section -->
    <ul class="right">
      <li class="has-form">
  <a href="/" class="button success" >Get Blessed</a>
</li>
     <li class="has-form">
  <a href="share.php" class="button " >Share !!</a>
</li>
    </ul>

  </section>
</nav>
<br><br>

    <div class="row">
        
        <form>
          <div class="row">
          <div class="large-6 columns">
            <label>Search for a address</label>
              <input type="text" id="autocomplete" onFocus="geolocate()" placeholder="Its intelligent try it!" />
          </div>
            <div class="large-6 columns">
              <label>Whats you are interested today</label>
              <input type="text" id="search" placeholder="Search Keywords" />
            </div>
          </div>
        </form>
      </div>
      
      <div id="map">
      </div>

<hr>

<script>
  var geocoder;
  var map;
  function initialize() {
	  initMap();
  }

  function searchLocation(pos) {
        $.ajax({
            type: "GET",
            url: "https://free-mium.search.windows.net/indexes/events/docs?api-version=2015-02-28&search=*&$filter=geo.distance(location, geography'POINT(" + pos.lat + " " + pos.lng + ")')+le+1",
            success: function (data) {
				if (data.value.length == 0) {
					//alert("no event found"); // todo: hope for better presentation
				} 
				else {
					drawMap(data);
				}
			}
        });
  }
  
  function drawMap(map, retData) {
	  if (retData.value.length == 0) return ;
	  
	  var bestEvent = retData.value[0];
	  map.setCenter(location2pos(bestEvent.location));
	  
	  for (event in retData.value) {
			marker = new google.maps.Marker({
				map: map,
				draggable: true,
				animation: google.maps.Animation.DROP,
				position: location2pos(event.location)
			});
			marker.addListener('click', toggleBounce);
	  }
  }
  
  
function toggleBounce() {
  if (marker.getAnimation() !== null) {
    marker.setAnimation(null);
  } else {
    marker.setAnimation(google.maps.Animation.BOUNCE);
  }
}
  
  function location2pos(location) {
	  return {
		  lat: location.coordinates[0],
		  lng: location.coordinates[1]
	  };
  }
</script>

<script>
		function handleLocationError(browserHasGeolocation) {
		  alert(browserHasGeolocation ?
		                        'Error: The Geolocation service failed.' :
		                        'Error: Your browser doesn\'t support geolocation.');
		}

		function getCurrentPosition () {
			var currentPosition = {};
				// Try HTML5 geolocation.
		  if (navigator.geolocation) {
		  	navigator.geolocation.getCurrentPosition(function(position) {
		  		 currentPosition = {
		  			lat: position.coords.latitude,
		  			lng: position.coords.longitude
		  		};
		  	}, function() {
		  		handleLocationError(true);
		  	});
		  } else {
		    // Browser doesn't support Geolocation
		    handleLocationError(false);
		  }
		  return currentPosition;
		}

		function initMap() {
			var pos = getCurrentPosition();
			var mapCanvas = document.getElementById('map');
			var mapOptions = {
				center: pos,
				zoom: 12,
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				zoomControl: true,
				mapTypeControl: true,
				scaleControl: true,
				streetViewControl: true,
				rotateControl: true
			};
			var map = new google.maps.Map(mapCanvas, mapOptions);
			searchLocation(pos);
	}
</script>

    <script>
// This example displays an address form, using the autocomplete feature
// of the Google Places API to help users fill in the information.

var placeSearch, autocomplete;

function initAutocomplete() {
  // Create the autocomplete object, restricting the search to geographical
  // location types.
  autocomplete = new google.maps.places.Autocomplete(
      /** @type {!HTMLInputElement} */(document.getElementById('autocomplete')),
      {types: ['geocode']});

  // When the user selects an address from the dropdown, populate the address
  // fields in the form.
  autocomplete.addListener('place_changed', fillInAddress);
}

// [START region_fillform]
function fillInAddress() {
  // Get the place details from the autocomplete object.
  var place = autocomplete.getPlace();
  console.log(place);
}
// [END region_fillform]

// [START region_geolocation]
// Bias the autocomplete object to the user's geographical location,
// as supplied by the browser's 'navigator.geolocation' object.
function geolocate() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var geolocation = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      var circle = new google.maps.Circle({
        center: geolocation,
        radius: position.coords.accuracy
      });
      autocomplete.setBounds(circle.getBounds());
    });
  }
}
// [END region_geolocation]


    </script>
<script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    <script src="js/foundation/foundation.topbar.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA1MgYE-d_EX4Jq0b-D-eB2px1NTQxYXW0&signed_in=true&libraries=places&callback=initAutocomplete"
        async defer></script>
<script async defer
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA1MgYE-d_EX4Jq0b-D-eB2px1NTQxYXW0&callback=initMap">
</script>
<script>
      $(document).foundation();
    </script>

  </body>
</html>
